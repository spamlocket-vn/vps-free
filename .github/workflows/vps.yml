name: 10 VPS Free

on:
  workflow_dispatch:

jobs:
  vps:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        vps_id: [1,2,3,4,5,6,7,8,9,10]
    steps:
      - name: Update & Install tmate
        run: |
          sudo apt update
          sudo apt install -y tmate curl wget gnupg

      - name: Cài Node.js + npm
        run: |
          curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -
          sudo apt-get install -y nodejs
          node -v
          npm -v

      - name: Cài Google Chrome
        run: |
          wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
          sudo apt install -y ./google-chrome-stable_current_amd64.deb
          google-chrome --version

      - name: Cài thư viện Node (global)
        run: |
          npm install -g \
            yarn \
            pm2 \
            puppeteer \
            puppeteer-extra \
            puppeteer-extra-plugin-stealth \
            puppeteer-real-browser \
            axios \
            express

      - name: Tải raw.js từ repo
        run: |
          wget -O raw.js "https://raw.githubusercontent.com/spamlocket-vn/vps-free/main/raw.js"
          ls -lh raw.js
          echo "📂 File raw.js đã được tải về, bạn SSH vào rồi chạy: node raw.js"

      - name: Start tmate (VPS${{ matrix.vps_id }})
        run: |
          tmate -S /tmp/tmate.sock new-session -d
          tmate -S /tmp/tmate.sock wait tmate-ready
          echo "🔑 VPS${{ matrix.vps_id }} SSH:"
          tmate -S /tmp/tmate.sock display -p '#{tmate_ssh}'
          echo "🌐 VPS${{ matrix.vps_id }} Web:"
          tmate -S /tmp/tmate.sock display -p '#{tmate_web}'

      - name: Keep alive 1h
        run: |
          echo "✅ VPS${{ matrix.vps_id }} đã sẵn sàng (có sẵn raw.js)."
          sleep 1h
